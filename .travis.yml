# http://www.debonair.io/post/maven-cd/ was helpful
sudo: required
services:
  - docker
env:
  global:
    - secure: "YD1flPPSUO+2rLgdmN29Lu4YUY9cej0mJczt6DF7s88wxK1/j/OsDpsKRpoPOaHvSbQNiWuuSkSuVKj4yvyKoF+7GnDmy7xoapuwdCdfGGVFcHwzNEwYqZRAp74T+rRuYodp2/xriu92UgwIaKhZ7+nwabZ8OBo+wAtpVj9YniEQ987hjrKHHOCx2d1Mw1OR+JnyKFwiF+ugL9c7hGCXU+m1dytFBDDdroyRQ4LMqnBg1OZBm1AInEZ72diMEKV3jq3PYX8lnaFqRsc5reNFm47ri8+tiQob542g4Orn2ymEQr4zWOnu3aTealZ3NlWLT4WzAuSgrg952VyIadownV3wvwWyDQ8c/G7Ia9PxpBEqyJptxEIOINwVGzOGFVUP3u6PqVVmX+AP1LZqJ1TU5SpO5USUwTHV3vVCf/JUOg9AjpYRCnOoNYjU6BQUXveaActtgbnN67EJaNLqXSNNLeleDDePgnREilJox4deTgmlosPtsWaE33aQIfpF3IR7nnp/DMFV4TrMQqMg9AdLI5M6QJqq44IX5L9aH5gxkJ7YrslMgTQnVrjQ55DltwPyoFySvzUWxIE+/eyR091knf4HFCD2fmrDYc9pBJ+Xs8m3MFkJZ+/KI3Yn6rCS30XXfZaef5Vu47sRs2txB1T4ru+Bi6CRRXknx41jwCl+BXE="
    - # ^^ OSSRH_JIRA_USERNAME
    - secure: "lGlhuLf6l+SE8ln5OSP9kT25aUpu0e75waUcfOXQQhnXdyVMXZpDZFl6zDDvPpbJZx7AE9zQQ/pUq45x4MCxdB0ZuHhG9FOfk61RH6/YGisromKFqXp54t7RGn1wafUi0jyrjCrgutfLyQiZpErzdrCNbp8gMZvRFl0aRBkpDuXCYlFBBI+P7lxYukeqtS0aBgtyLlxndOs7AH+UQbA+faAs+2mqfd+pH6+UKcAjCghziMovy4ocsFvCxhJsj9SaXYBZXTby2my7PxpIc1MuH+3GCk3XQK4Up5H0BE92yxVBJTXDoWT4POQbvtXQz4nXNanSht7z2nEvK10tZFk0gG/0EeduYVfMW3WQp3pqh57id7yLwG9kU8wDTwNIleeNhIsIod7wh9GzhbXl9BXMOhIrdAsln0bMwch6JEol3FuC5Y+NldhkpM3CGy3QSIgd6lIEf83hDpZLhyOmM1JZNGFX5ozenUkeYHqXgU7LTaJlPziItMOl3k+NiLB4iv1x11rD2LlsBroCcrt3rMNrZSSX9n4STCwjBliYUeTHNDvIXtk7idIKLNHxSN3RtaWaxOIr1bxae3R46tMsKbjs+PpIOtZBLBMKu+kkXsEuxyQJdUpzuayYBTLPePnDArjXAYnFK0zChJCuuaoB2H/TZjdYL/mONNjY9Fv8CJBA4y8="
    - # ^^ OSSRH_JIRA_PASSWORD
    - secure: "Gy0rjUOghYz+Qd9C+tj8Uut+dObjTe4v0r/5FTcROMifXcItvEJtEf/+Q0r5vv92F00Ha2FbjWxYrzYfYrK/4ZWqF6oMLP01gyoZ07S6dG7RMf3CFjUJXi8VXfJeiEHHJZrWBv3UCjDNxDDlspK1H0yPkaY3//S5qtZz/E5gJd0xXRHPTq9BtnirR5MdtyWhgw+tofUzGcE0igmlcY7wvoizJ16py92ADMJd1bwSwNWkD2mH7Y+BmINtQH9QLKYLCEO3lI6ZGeOAM0aDU0Ga0RpSUbSqlXB6i8sRPYn5a7qzeqMWROET1moBBTdm2Fxx8yn7Wd+Fmn3QODZhNt40yRNHEpzkIWZZtbXqzrPy32mKABArBQCG04sbfUE37/plaE2ZXSxdiTf/GtYOlCQ5NfM/+ySmFxrhd62dw/7OBhBzgk14AGLDGVLNZOX1KJAkNUiz4e7iXk7lxFR/S+T3+vtkttg+B4VDJbYwcIkHiHyjFawqw2wCjY+Oc/BiIdakPnaSRnZfJljwJFLppLxz0vrgB204dzKig0RnA2YcMoQD904Jh2ydqmC2Rhl6azZkcZSXmKAiHVHjR7KVIPViEReqXGmKV+vPxUMrAwE2qCv2myZjMFBUyI8YU0Y4S7Go3CyvMDnbuKTW9DFGpnVlbjTUHtAC5Ee7PJf5AiCIM78="
    - # ^^ GPG_KEY_NAME
    - secure: "fY++0lNC63Pl/fIYKkCh+VlHxly64mMYJ7rFz3DRyVwCYZxTmrADphFfwWgWzuMWkD8oCdvdxrwCAQ9w5exYbEhRiKzSfuyagdkWBKTlkcouYpZLXncY1vf02gZO5VWJXX8WAlDQPlWOWJWrj+cWZEeX+OVXsHlJRHokXfPIQ/2WRUKBMyFtSdgtmS/BFLGKAgpN7sCHVqIree82Rj0gZVFy2drCBaLySbHk4OZeW3sbIcJulmmrbM2Rt7gWIkSWZnPZwofbhcwl8G27dwUdn24AIz9zSbn858+ZLCdQd79zjo2FeHnW0VLOYDDG4OLW1/kGgQ0WDIGpDy0Vmzrdyrd+5+BMqc3xYlQ3TuYqT7TfoJH2hqh4QGRg5S+2y0W49vb4l1t8eJKB9pXDGgtw1QyHBOG+P84mCQ62USWMM12Ioni799hM37pJiEMmhWApinw/aK5iCiBcHcmPlIu1pXCvhMuSHbs3odb5AZp0WnNvU0V4RlKLqNskNkyR12knRQTRv+A4R7egCGJ8VoPkKRhxlS9diOnxBf8C4nxPmIwZtdixKJvEqAavArxKjBNplXfFTdz7gn4FTn27iDdA5ORXBaqpWhHUaPYA3JS3pb5QN7imINIjIdSK6la6WhI7iySRLRJk/kir7YsF9tAbIoqbHoqdqCpcLSKnvMShpVE="
    - # ^^ GPG_PASSPHRASE
    - secure: "l0niICCC0yQYbvfyWHLXzKzvF/Fbxv5I0/ugCZrMTjIb/uktqGQ1mM3RwvIjX+lriKFL10coS+u8O1yLsD3l2ba1sm6aCCDT22m/s6AQb+XYjIELq88xj+JEpQ8Ab5csGaoaCRZwrdvkAKNUBMN9tv+FF+Xmu8GEUm7XQ70vF2F6kfNb2Fly1KZJBhhO4YSQPavnj/PIkXCqeYVvBjCJ3r0SNq1D4drvhlYd7iqhD0XPqA46TY+N9YCsUz0R9rzuIpJRWceTWvG7NltsO2OuWj7kxoyMZqsKwNjPwP9l7ux0jXYdsMnNnMGXgZZ5KCBKcmVIJy8/QrRJ+2O2EUVHEyNaa4utiLmOrUNteQBbQIT7cqsk10JG8WYz5PAfysJaO1tnHE2wVkn8IILyoeRHi4hImCfjs4GsLzbvhWZZbAfkUbyHz9gY7YT2DEYx9obUpyJL0FcONNXsQqSBYol1G7i9j3NzJohACKS96YazEyxG0z8AVrLiOAdG9poGgoyApV5mAAJ7vjDAgRWnY+YejcEKVirrbamdxcwKbjUTu1TSFzAwOn/1BfCpIk2fki3EXNTIMjLBEHyIjqwOrZSi3bdhUOBH9l5QDMfquhYi7C6on1CnPDnoM/GX9jBONf8RzQYmHWiEj2cWU11jXkgi9E6AcKtboOSPmHkmrZ6e6UE="
    - # ^^ NPM_AUTH_TOKEN
branches:
  only:
    - master
    - /^v[0-9]+\.[0-9]+\.x$/
    - /^v[0-9]+\.[0-9]+\.[0-9]+$/
install:
  - mkdir -p ~/.yaktor
  - curl -L https://github.com/SciSpike/yaktor/archive/v0.3.0.zip > ~/.yaktor/yaktor.zip
  - unzip ~/.yaktor/yaktor.zip -d ~/.yaktor
  - docker build -t build:latest docker
  - docker run -d --name bob -v $PWD:/build -v ~/.yaktor/yaktor-0.3.0:/yaktor -e MAVEN_OPTS="-Xms256m -XX:MaxPermSize=1024m -Xmx1024m" -e MAVEN_SETTINGS=cli/maven-deploy-settings.xml -e CLI_DIR=cli -e OSSRH_JIRA_USERNAME="$OSSRH_JIRA_USERNAME" -e OSSRH_JIRA_PASSWORD="$OSSRH_JIRA_PASSWORD" -e GPG_KEY_NAME="$GPG_KEY_NAME" -e GPG_PASSPHRASE="$GPG_PASSPHRASE" -e encrypted_ff7df2c82614_key="$encrypted_ff7df2c82614_key" -e encrypted_ff7df2c82614_iv="$encrypted_ff7df2c82614_iv" build:latest tail -f /dev/null
script:
  - docker exec -it bob mvn clean install -B -V -P release -Dyaktor.version=/yaktor
  - docker exec -it bob cli/travis-before-deploy.sh
  - docker exec -it bob cli/maven-deploy.sh
